#root = location  (after winning and losing, for both), scope:winner = new owner country, scope:loser = previous owner country
on_location_changed_owner = {
	on_actions = {
		dbo_on_conquer_any_location
		dbo_on_conquer_anatolian
		dbo_on_ottoman_miracle
		dbo_on_timur_conquer_any_location
	}
}

dbo_on_conquer_any_location = {
	trigger = {
		tag_exists = TUR
		scope:winner = {
			tag = TUR
		}
	}
	effect = {
		if = {
			limit = {
				culture_percentage = {
					culture = scope:winner.culture
					value < 0.2
				}
			}
			add_pop = {
				culture = scope:winner.culture
				religion = scope:winner.religion
				type = pop_type:peasants
				size = {
					value = population
					multiply = 0.1
					min = 0.5
					max = 2
				}
			}
		}
		if = {
			limit = {
				has_location_modifier = dbo_ottoman_scare
			}
			remove_location_modifier = dbo_ottoman_scare
		}
		add_location_modifier = {
			modifier = dbo_ottoman_miracle
			years = 40
			mode = replace
		}
		construct_building = {
			building_type = building_type:dbo_otag
			cost_multiplier = 0
			cost_multiplier_reason = "otag_must_be_free"
			instant = yes
		}
	}
}

dbo_on_timur_conquer_any_location = {
	trigger = {
		tag_exists = TIM
		scope:winner = {
			tag = TIM
		}
	}
	effect = {
		if = {
			limit = {
				culture_percentage = {
					culture = scope:winner.culture
					value < 0.2
				}
			}
			add_pop = {
				culture = scope:winner.culture
				religion = scope:winner.religion
				type = pop_type:peasants
				size = {
					value = population
					multiply = 0.1
					min = 0.5
					max = 2
				}
			}
		}
		construct_building = {
			building_type = building_type:dbo_otag
			cost_multiplier = 0
			cost_multiplier_reason = "otag_must_be_free"
			instant = yes
		}
		change_integration_level = integrated
		scope:winner = {
			add_gold = {
				value = root.location_tax_base
				multiply = 0.25
			}
		}
	}
}

dbo_on_ottoman_miracle = {
	trigger = {
		tag_exists = TUR
		NOT = {
			owner = c:TUR
		}
	}
	effect = {
		if = {
			limit = {
				has_location_modifier = dbo_ottoman_miracle
			}
			remove_location_modifier = dbo_ottoman_miracle
		}
	}
}

dbo_on_conquer_anatolian = {
	trigger = {
		tag_exists = TUR
		scope:winner ?= {
			tag = TUR
		}
		OR = {
			scope:loser ?= {
				has_reform = government_reform:anatolian_beylik
			}
			OR = {
				root.area = area:thrace_area
				root.area = area:macedonia_area
				root.area = area:armenian_highlands_area
				root.region = region:anatolia_region
				root.province_definition = province_definition:meskheti_province
				root.province_definition = province_definition:hasankeyf_province
				root.province_definition = province_definition:diyarbekir_province
				root.province_definition = province_definition:ar_ruha_province
				root.province_definition = province_definition:amadiya_province
				root.province_definition = province_definition:nusaybin_province
				root.province_definition = province_definition:mardin_province
				root.province_definition = province_definition:ayntab_province
				root.province_definition = province_definition:antakya_province
			}
		}
	}
	effect = {
		root = {
			change_integration_level = core
		}
	}
}
